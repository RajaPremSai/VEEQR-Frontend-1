import{r as i,j as e}from"./chunk-Cm16MDj1.js";import{B as $}from"./chunk-CwsOYC4S.js";import{a as W}from"./chunk-C7aFLusC.js";const q="modulepreload",z=function(a){return"/"+a},U={},J=function(b,x,N){let j=Promise.resolve();if(x&&x.length>0){document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),g=m?.nonce||m?.getAttribute("nonce");j=Promise.allSettled(x.map(c=>{if(c=z(c),c in U)return;U[c]=!0;const f=c.endsWith(".css"),o=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${o}`))return;const h=document.createElement("link");if(h.rel=f?"stylesheet":q,f||(h.as="script"),h.crossOrigin="",h.href=c,g&&h.setAttribute("nonce",g),document.head.appendChild(h),f)return new Promise((L,w)=>{h.addEventListener("load",L),h.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${c}`)))})}))}function d(m){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=m,window.dispatchEvent(g),!g.defaultPrevented)throw m}return j.then(m=>{for(const g of m||[])g.status==="rejected"&&d(g.reason);return b().catch(d)})},k=W.create({baseURL:"http://localhost:5000",timeout:1e4,headers:{"Content-Type":"application/json"}});k.interceptors.request.use(a=>{const b=localStorage.getItem("token");return b&&(a.headers.Authorization=`Bearer ${b}`),a.metadata={startTime:new Date},a},a=>Promise.reject(a));k.interceptors.response.use(a=>(new Date-a.config.metadata.startTime,a),a=>(a.code,a.response?.status===401&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject(a)));function te(){const[a,b]=i.useState([]),[x,N]=i.useState([]),[j,d]=i.useState({todayEntries:0,todayExits:0,activeVehicles:0}),[m,g]=i.useState({gateNumber:"",direction:"IN",vehicleNumber:""}),[c,f]=i.useState(""),[o,h]=i.useState(!1),[L,w]=i.useState(new Date);i.useEffect(()=>{D();const l=setInterval(D,3e4);return()=>clearInterval(l)},[]);const D=async()=>{try{const y=(await k.get("/api/security-guards/gates")).data.gates||[];b(y),y[0]&&!m.gateNumber&&g(p=>({...p,gateNumber:y[0].gateNumber}));const E=await k.get("/api/security-guards/logs?limit=5");N(E.data.logs||[]);const T=new Date().toDateString(),I=(E.data.logs||[]).filter(p=>new Date(p.timeIn||p.createdAt).toDateString()===T);d({todayEntries:I.filter(p=>p.direction==="IN"||p.timeIn).length,todayExits:I.filter(p=>p.direction==="OUT"||p.timeOut).length,activeVehicles:I.filter(p=>p.timeIn&&!p.timeOut).length}),w(new Date)}catch{}},A=async l=>{l.preventDefault(),f(""),h(!0);try{const{data:y}=await k.post("/api/security-guards/logs",m);f(`Successfully logged ${m.direction} for ${y.log.vehicleNumber}`),g(E=>({...E,vehicleNumber:""})),setTimeout(D,1e3)}catch(y){f(y?.response?.data?.message||"Failed to log entry")}finally{h(!1)}},R=l=>{l==="scanner"?window.location.href="/guard/scanner":l==="logs"?window.location.href="/guard/logs":l==="gates"&&(window.location.href="/guard/gates")};return e.jsxs("div",{className:"guard-dashboard",children:[e.jsxs("div",{className:"status-board",children:[e.jsxs("div",{className:"status-header",children:[e.jsx("h2",{children:"Security Guard Dashboard"}),e.jsxs("div",{className:"last-update",children:[e.jsx("span",{className:"update-indicator"}),"Last updated: ",L.toLocaleTimeString()]})]}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card entries",children:[e.jsx("div",{className:"stat-icon",children:"ğŸ“¥"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-number",children:j.todayEntries}),e.jsx("div",{className:"stat-label",children:"Today's Entries"})]})]}),e.jsxs("div",{className:"stat-card exits",children:[e.jsx("div",{className:"stat-icon",children:"ğŸ“¤"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-number",children:j.todayExits}),e.jsx("div",{className:"stat-label",children:"Today's Exits"})]})]}),e.jsxs("div",{className:"stat-card active",children:[e.jsx("div",{className:"stat-icon",children:"ğŸš—"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-number",children:j.activeVehicles}),e.jsx("div",{className:"stat-label",children:"Vehicles Inside"})]})]}),e.jsxs("div",{className:"stat-card gates",children:[e.jsx("div",{className:"stat-icon",children:"ğŸšª"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-number",children:a.length}),e.jsx("div",{className:"stat-label",children:"Assigned Gates"})]})]})]})]}),e.jsxs("div",{className:"quick-actions-panel",children:[e.jsx("h3",{children:"Quick Actions"}),e.jsxs("div",{className:"action-buttons",children:[e.jsxs("button",{className:"action-btn scanner-btn",onClick:()=>R("scanner"),children:[e.jsx("div",{className:"action-icon",children:"ğŸ“±"}),e.jsx("div",{className:"action-label",children:"QR Scanner"}),e.jsx("div",{className:"action-desc",children:"Scan vehicle QR codes"})]}),e.jsxs("button",{className:"action-btn logs-btn",onClick:()=>R("logs"),children:[e.jsx("div",{className:"action-icon",children:"ğŸ“‹"}),e.jsx("div",{className:"action-label",children:"View Logs"}),e.jsx("div",{className:"action-desc",children:"Check entry/exit logs"})]}),e.jsxs("button",{className:"action-btn gates-btn",onClick:()=>R("gates"),children:[e.jsx("div",{className:"action-icon",children:"ğŸšª"}),e.jsx("div",{className:"action-label",children:"My Gates"}),e.jsx("div",{className:"action-desc",children:"Manage assigned gates"})]})]})]}),e.jsxs("div",{className:"manual-entry-card",children:[e.jsx("h3",{children:"Manual Vehicle Entry"}),e.jsxs("form",{onSubmit:A,className:"manual-entry-form",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Gate"}),e.jsxs("select",{className:"input",value:m.gateNumber,onChange:l=>g(y=>({...y,gateNumber:l.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Choose Gate"}),a.map(l=>e.jsxs("option",{value:l.gateNumber,children:[l.gateName," (",l.gateNumber,")"]},l._id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Direction"}),e.jsxs("select",{className:"input direction-select",value:m.direction,onChange:l=>g(y=>({...y,direction:l.target.value})),children:[e.jsx("option",{value:"IN",children:"Entry (IN)"}),e.jsx("option",{value:"OUT",children:"Exit (OUT)"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Vehicle Number"}),e.jsx("input",{className:"input vehicle-input",value:m.vehicleNumber,onChange:l=>g(y=>({...y,vehicleNumber:l.target.value.toUpperCase()})),placeholder:"Enter vehicle number (e.g., KA01AB1234)",required:!0})]}),e.jsx("button",{className:"btn submit-btn",type:"submit",disabled:o||!m.gateNumber||!m.vehicleNumber,children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"submit-icon",children:"âœ“"}),"Log ",m.direction==="IN"?"Entry":"Exit"]})}),c&&e.jsx("div",{className:`message ${c.includes("Successfully")?"success":"error"}`,children:c})]})]}),e.jsxs("div",{className:"recent-activity-card",children:[e.jsx("h3",{children:"Recent Activity"}),x.length===0?e.jsxs("div",{className:"no-activity",children:[e.jsx("div",{className:"no-activity-icon",children:"ğŸ“"}),e.jsx("p",{children:"No recent activity"})]}):e.jsx("div",{className:"activity-list",children:x.slice(0,5).map(l=>e.jsxs("div",{className:"activity-item",children:[e.jsx("div",{className:`activity-indicator ${l.direction||(l.timeOut?"OUT":"IN")}`,children:l.direction==="OUT"||l.timeOut?"ğŸ“¤":"ğŸ“¥"}),e.jsxs("div",{className:"activity-content",children:[e.jsx("div",{className:"activity-vehicle",children:l.vehicleNumber}),e.jsxs("div",{className:"activity-details",children:["Gate ",l.gateNumber," â€¢"," ",l.direction||(l.timeOut?"EXIT":"ENTRY")," â€¢",new Date(l.timeIn||l.timeOut||l.createdAt).toLocaleTimeString()]})]})]},l._id))})]})]})}function ae(){const[a,b]=i.useState([]),[x,N]=i.useState([]),[j,d]=i.useState(!1),[m,g]=i.useState([]),[c,f]=i.useState({search:"",direction:"",gate:"",dateFrom:"",dateTo:"",status:""}),[o,h]=i.useState({key:"timeIn",direction:"desc"}),[L,w]=i.useState(1),[D]=i.useState(20),[A,R]=i.useState([]);i.useEffect(()=>{l(),y()},[]),i.useEffect(()=>{E()},[a,c,o]);const l=async()=>{d(!0);try{const{data:s}=await k.get("/api/security-guards/logs");b(s.logs||[])}catch{}finally{d(!1)}},y=async()=>{try{const{data:s}=await k.get("/api/security-guards/gates");R(s.gates||[])}catch{}},E=()=>{let s=[...a];if(c.search){const t=c.search.toLowerCase();s=s.filter(u=>u.vehicleNumber?.toLowerCase().includes(t)||u.vehicleOwner?.toLowerCase().includes(t)||u.gateNumber?.toLowerCase().includes(t))}if(c.direction&&(s=s.filter(t=>c.direction==="IN"?t.timeIn&&!t.timeOut:c.direction==="OUT"?t.timeOut:!0)),c.gate&&(s=s.filter(t=>t.gateNumber===c.gate)),c.dateFrom){const t=new Date(c.dateFrom);s=s.filter(u=>new Date(u.timeIn||u.timeOut||u.createdAt)>=t)}if(c.dateTo){const t=new Date(c.dateTo);t.setHours(23,59,59,999),s=s.filter(u=>new Date(u.timeIn||u.timeOut||u.createdAt)<=t)}c.status&&(s=s.filter(t=>c.status==="active"?t.timeIn&&!t.timeOut:c.status==="completed"?t.timeIn&&t.timeOut:!0)),o.key&&s.sort((t,u)=>{let S=t[o.key],n=u[o.key];return(o.key==="timeIn"||o.key==="timeOut")&&(S=S?new Date(S):new Date(0),n=n?new Date(n):new Date(0)),S<n?o.direction==="asc"?-1:1:S>n?o.direction==="asc"?1:-1:0}),N(s),w(1)},T=s=>{h(t=>({key:s,direction:t.key===s&&t.direction==="asc"?"desc":"asc"}))},I=s=>{g(t=>t.includes(s)?t.filter(u=>u!==s):[...t,s])},p=()=>{const s=Q(),t=s.every(u=>m.includes(u._id));g(t?u=>u.filter(S=>!s.find(n=>n._id===S)):u=>[...new Set([...u,...s.map(S=>S._id)])])},F=()=>{f({search:"",direction:"",gate:"",dateFrom:"",dateTo:"",status:""})},_=()=>{const s=m.length>0?x.filter(r=>m.includes(r._id)):x,t=[["Log ID","Vehicle Number","Vehicle Owner","Gate Number","Entry Time","Exit Time","Duration","Status"],...s.map(r=>{const v=r.timeIn?new Date(r.timeIn):null,C=r.timeOut?new Date(r.timeOut):null,G=v&&C?Math.round((C-v)/(1e3*60))+" min":"-",V=r.timeIn&&!r.timeOut?"Active":"Completed";return[r.logId||r._id.slice(-8),r.vehicleNumber,r.vehicleOwner||"N/A",r.gateNumber,v?v.toLocaleString():"-",C?C.toLocaleString():"-",G,V]})].map(r=>r.join(",")).join(`
`),u=new Blob([t],{type:"text/csv"}),S=window.URL.createObjectURL(u),n=document.createElement("a");n.href=S,n.download=`guard-logs-${new Date().toISOString().split("T")[0]}.csv`,n.click(),window.URL.revokeObjectURL(S)},Q=()=>{const s=(L-1)*D,t=s+D;return x.slice(s,t)},O=Math.ceil(x.length/D),P=Q();return e.jsxs("div",{className:"guard-logs-container",children:[e.jsxs("div",{className:"logs-header",children:[e.jsxs("div",{className:"header-content",children:[e.jsx("h2",{children:"Entry/Exit Logs"}),e.jsx("p",{children:"Manage and monitor vehicle logs for your assigned gates"})]}),e.jsxs("div",{className:"header-actions",children:[e.jsxs("button",{className:"btn secondary refresh-btn",onClick:l,disabled:j,children:[e.jsx("span",{className:"btn-icon",children:"ğŸ”„"}),j?"Refreshing...":"Refresh"]}),e.jsxs("button",{className:"btn export-btn",onClick:_,disabled:x.length===0,children:[e.jsx("span",{className:"btn-icon",children:"ğŸ“Š"}),"Export"," ",m.length>0?`(${m.length})`:"All"]})]})]}),e.jsxs("div",{className:"logs-filters",children:[e.jsxs("div",{className:"filters-row",children:[e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Search"}),e.jsx("input",{type:"text",className:"input filter-input",placeholder:"Vehicle number, owner, or gate...",value:c.search,onChange:s=>f(t=>({...t,search:s.target.value}))})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Gate"}),e.jsxs("select",{className:"input filter-select",value:c.gate,onChange:s=>f(t=>({...t,gate:s.target.value})),children:[e.jsx("option",{value:"",children:"All Gates"}),A.map(s=>e.jsxs("option",{value:s.gateNumber,children:[s.gateName," (",s.gateNumber,")"]},s._id))]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"Status"}),e.jsxs("select",{className:"input filter-select",value:c.status,onChange:s=>f(t=>({...t,status:s.target.value})),children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active (Inside)"}),e.jsx("option",{value:"completed",children:"Completed"})]})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"From Date"}),e.jsx("input",{type:"date",className:"input filter-input",value:c.dateFrom,onChange:s=>f(t=>({...t,dateFrom:s.target.value}))})]}),e.jsxs("div",{className:"filter-group",children:[e.jsx("label",{children:"To Date"}),e.jsx("input",{type:"date",className:"input filter-input",value:c.dateTo,onChange:s=>f(t=>({...t,dateTo:s.target.value}))})]})]}),e.jsxs("div",{className:"filters-actions",children:[e.jsxs("button",{className:"btn secondary clear-btn",onClick:F,children:[e.jsx("span",{className:"btn-icon",children:"âœ–ï¸"}),"Clear Filters"]}),e.jsxs("div",{className:"results-count",children:["Showing ",x.length," of ",a.length," logs"]})]})]}),m.length>0&&e.jsxs("div",{className:"bulk-actions",children:[e.jsx("div",{className:"bulk-info",children:e.jsxs("span",{children:[m.length," logs selected"]})}),e.jsxs("div",{className:"bulk-buttons",children:[e.jsx("button",{className:"btn secondary",onClick:()=>g([]),children:"Clear Selection"}),e.jsxs("button",{className:"btn export-btn",onClick:_,children:[e.jsx("span",{className:"btn-icon",children:"ğŸ“Š"}),"Export Selected"]})]})]}),e.jsx("div",{className:"logs-table-container",children:j?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading logs..."})]}):x.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:"ğŸ“"}),e.jsx("h3",{children:"No logs found"}),e.jsx("p",{children:"No logs match your current filters or you haven't been assigned any gates yet."}),e.jsx("button",{className:"btn secondary",onClick:F,children:"Clear Filters"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"logs-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"checkbox-column",children:e.jsx("input",{type:"checkbox",checked:P.length>0&&P.every(s=>m.includes(s._id)),onChange:p})}),e.jsxs("th",{className:`sortable ${o.key==="vehicleNumber"?o.direction:""}`,onClick:()=>T("vehicleNumber"),children:["Vehicle Number",e.jsx("span",{className:"sort-indicator",children:o.key==="vehicleNumber"?o.direction==="asc"?"â†‘":"â†“":"â†•ï¸"})]}),e.jsx("th",{children:"Owner"}),e.jsxs("th",{className:`sortable ${o.key==="gateNumber"?o.direction:""}`,onClick:()=>T("gateNumber"),children:["Gate",e.jsx("span",{className:"sort-indicator",children:o.key==="gateNumber"?o.direction==="asc"?"â†‘":"â†“":"â†•ï¸"})]}),e.jsxs("th",{className:`sortable ${o.key==="timeIn"?o.direction:""}`,onClick:()=>T("timeIn"),children:["Entry Time",e.jsx("span",{className:"sort-indicator",children:o.key==="timeIn"?o.direction==="asc"?"â†‘":"â†“":"â†•ï¸"})]}),e.jsxs("th",{className:`sortable ${o.key==="timeOut"?o.direction:""}`,onClick:()=>T("timeOut"),children:["Exit Time",e.jsx("span",{className:"sort-indicator",children:o.key==="timeOut"?o.direction==="asc"?"â†‘":"â†“":"â†•ï¸"})]}),e.jsx("th",{children:"Duration"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:P.map(s=>{const t=s.timeIn?new Date(s.timeIn):null,u=s.timeOut?new Date(s.timeOut):null,S=t&&u?Math.round((u-t)/(1e3*60))+" min":"-",n=s.timeIn&&!s.timeOut?"active":"completed";return e.jsxs("tr",{className:`log-row ${m.includes(s._id)?"selected":""} ${n}`,children:[e.jsx("td",{className:"checkbox-column",children:e.jsx("input",{type:"checkbox",checked:m.includes(s._id),onChange:()=>I(s._id)})}),e.jsx("td",{className:"vehicle-number",children:e.jsx("strong",{children:s.vehicleNumber})}),e.jsx("td",{className:"owner-name",children:s.vehicleOwner||"N/A"}),e.jsx("td",{className:"gate-number",children:e.jsx("span",{className:"gate-badge",children:s.gateNumber})}),e.jsx("td",{className:"entry-time",children:t?e.jsxs("div",{className:"time-display",children:[e.jsx("div",{className:"time-value",children:t.toLocaleTimeString()}),e.jsx("div",{className:"date-value",children:t.toLocaleDateString()})]}):e.jsx("span",{className:"no-data",children:"-"})}),e.jsx("td",{className:"exit-time",children:u?e.jsxs("div",{className:"time-display",children:[e.jsx("div",{className:"time-value",children:u.toLocaleTimeString()}),e.jsx("div",{className:"date-value",children:u.toLocaleDateString()})]}):e.jsx("span",{className:"no-data",children:"-"})}),e.jsx("td",{className:"duration",children:e.jsx("span",{className:"duration-badge",children:S})}),e.jsx("td",{className:"status",children:e.jsx("span",{className:`status-badge ${n}`,children:n==="active"?"ğŸŸ¢ Inside":"ğŸ”µ Completed"})})]},s._id)})})]})}),O>1&&e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:"btn secondary pagination-btn",onClick:()=>w(s=>Math.max(1,s-1)),disabled:L===1,children:"â† Previous"}),e.jsxs("div",{className:"pagination-info",children:["Page ",L," of ",O]}),e.jsx("button",{className:"btn secondary pagination-btn",onClick:()=>w(s=>Math.min(O,s+1)),disabled:L===O,children:"Next â†’"})]})]})})]})}const H=i.lazy(()=>J(()=>Promise.resolve().then(()=>Y),void 0));function K(){return e.jsx("div",{className:"qr-scanner-loading",children:e.jsxs("div",{className:"scanner-loading-container",children:[e.jsx("div",{className:"scanner-loading-icon",children:"ğŸ“±"}),e.jsx("h3",{children:"Loading QR Scanner..."}),e.jsx("p",{children:"Initializing camera and scanning components"}),e.jsx("div",{className:"loading-spinner"})]})})}function ne(){return e.jsx(i.Suspense,{fallback:e.jsx(K,{}),children:e.jsx(H,{})})}function ie(){const[a,b]=i.useState(null),[x,N]=i.useState(!1),j=async()=>{N(!0);try{const{data:d}=await k.get("/api/security-guards/profile");b(d.profile)}catch{}finally{N(!1)}};return i.useEffect(()=>{j()},[]),x?e.jsx("div",{children:"Loading profile..."}):a?e.jsx("div",{children:e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"My Profile"}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsx("table",{style:{width:"100%",borderCollapse:"collapse"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{style:{borderBottom:"1px solid #ddd"},children:[e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd",fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"Full Name"}),e.jsxs("td",{style:{padding:"8px",border:"1px solid #ddd"},children:[a.firstName," ",a.middleName?a.middleName+" ":"",a.lastName]})]}),e.jsxs("tr",{style:{borderBottom:"1px solid #ddd"},children:[e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd",fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"Employee Number"}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:a.empNumber})]}),e.jsxs("tr",{style:{borderBottom:"1px solid #ddd"},children:[e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd",fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"Security Guard ID"}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:a.securityGuardId})]}),e.jsxs("tr",{style:{borderBottom:"1px solid #ddd"},children:[e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd",fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"Email"}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:a.email})]}),e.jsxs("tr",{style:{borderBottom:"1px solid #ddd"},children:[e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd",fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"Contact Number"}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:a.contactNumber||"N/A"})]}),e.jsxs("tr",{style:{borderBottom:"1px solid #ddd"},children:[e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd",fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"Role"}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:a.role})]}),e.jsxs("tr",{style:{borderBottom:"1px solid #ddd"},children:[e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd",fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"Assigned Gates"}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:a.assignedGates&&a.assignedGates.length>0?a.assignedGates.map(d=>d.gateName).join(", "):"No gates assigned"})]}),e.jsxs("tr",{style:{borderBottom:"1px solid #ddd"},children:[e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd",fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"Member Since"}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:a.createdAt?new Date(a.createdAt).toLocaleDateString():"N/A"})]})]})})})]})}):e.jsx("div",{children:"Profile not found"})}function re(){const[a,b]=i.useState([]),[x,N]=i.useState(!1),j=async()=>{N(!0);try{const{data:d}=await k.get("/api/security-guards/gates");b(d.gates||[])}catch{}finally{N(!1)}};return i.useEffect(()=>{j()},[]),e.jsx("div",{children:e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"My Assigned Gates"}),x?e.jsx("div",{children:"Loading gates..."}):a.length===0?e.jsx("div",{children:"No gates assigned to you yet."}):e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f5f5f5"},children:[e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd",textAlign:"left"},children:"Gate Number"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd",textAlign:"left"},children:"Gate Name"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd",textAlign:"left"},children:"Status"})]})}),e.jsx("tbody",{children:a.map(d=>e.jsxs("tr",{style:{borderBottom:"1px solid #ddd"},children:[e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:e.jsx("strong",{children:d.gateNumber})}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:d.gateName}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:e.jsx("span",{style:{color:"green",fontWeight:"bold"},children:"Active"})})]},d._id))})]})})]})})}function ce(){const[a,b]=i.useState([]),[x,N]=i.useState(!1),j=async()=>{N(!0);try{const{data:d}=await k.get("/api/security-guards/announcements");b(d.announcements||[])}catch{}finally{N(!1)}};return i.useEffect(()=>{j()},[]),e.jsx("div",{children:e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Announcements"}),x?e.jsx("div",{children:"Loading announcements..."}):a.length===0?e.jsx("div",{children:"No announcements available."}):e.jsx("div",{children:a.map(d=>e.jsxs("div",{className:"card",style:{marginBottom:"15px",border:"1px solid #ddd"},children:[e.jsx("h4",{style:{margin:"0 0 10px 0",color:"#333"},children:d.title}),e.jsx("p",{style:{margin:"0 0 10px 0",lineHeight:"1.5"},children:d.description}),e.jsxs("div",{style:{fontSize:"12px",color:"#666"},children:[e.jsx("strong",{children:"Date:"})," ",d.date?new Date(d.date).toLocaleDateString():"N/A"," |",e.jsx("strong",{children:" Published:"})," ",d.createdAt?new Date(d.createdAt).toLocaleString():"N/A"]})]},d._id))})]})})}function X(){const[a,b]=i.useState(!1),[x,N]=i.useState(null),[j,d]=i.useState(null),[m,g]=i.useState([]),[c,f]=i.useState({gateNumber:"",direction:"IN"}),[o,h]=i.useState(""),[L,w]=i.useState(!1),[D,A]=i.useState(!1),[R,l]=i.useState(0),[y,E]=i.useState(!1),T=i.useRef(null),I=i.useRef(null),p=i.useRef(null);i.useEffect(()=>(F(),()=>P()),[]);const F=async()=>{try{const{data:n}=await k.get("/api/security-guards/gates");g(n.gates||[]),(n.gates||[])[0]&&f(r=>({...r,gateNumber:n.gates[0].gateNumber}))}catch{}},_=async()=>{try{p.current&&p.current.requestFullscreen&&(await p.current.requestFullscreen(),E(!0))}catch{}},Q=async()=>{try{document.fullscreenElement&&await document.exitFullscreen(),E(!1)}catch{}},O=async()=>{try{h("Initializing camera...");const n=new $;I.current=n,b(!0),N(null),d(null),l(0),window.innerWidth<=768&&await _();const r=await $.listVideoInputDevices(),v=r.find(G=>/back|rear|environment/i.test(G.label)),C=v?v.deviceId:r[0]?.deviceId;if(!C)throw new Error("No camera found");h("Camera ready - Point at QR code"),await n.decodeFromVideoDevice(C,T.current,(G,V,M)=>{G&&(M.stop(),A(!0),setTimeout(()=>A(!1),1e3),t(G.getText()),l(B=>B+1))}),h("")}catch{h("Camera access failed. Please check permissions and try again."),b(!1),E(!1)}},P=async()=>{try{I.current?.reset()}catch{}b(!1),y&&await Q()},s=async()=>{await t("KA01AB1234")},t=async n=>{try{w(!0),h("Processing QR code...");let r=(n||"").trim();if(!r){h("Empty QR data - Please try again"),w(!1);return}if(r.startsWith("{")||r.startsWith("["))try{const v=JSON.parse(n);r=(typeof v.payload=="string"?JSON.parse(v.payload):v.payload)?.vehicleNumber||""}catch{r=(n||"").trim()}if(!r){h("Unable to extract vehicle number from QR code"),w(!1);return}if(r==="TEST123"){d({vehicleNumber:"TEST123",vehicleType:"Car",vehicleOwner:"Test User",driverName:"Test Driver",driverMobileNumber:"+91 9876543210"}),N(n),h("âœ… Test vehicle found!"),w(!1);return}if(r==="KA01AB1234"){d({vehicleNumber:"KA01AB1234",vehicleType:"Car",vehicleOwner:"John Doe",driverName:"John Doe",driverMobileNumber:"+91 9876543210"}),N(n),h("âœ… Vehicle found!"),w(!1);return}try{const{data:v}=await k.get(`/api/security-guards/vehicles/${r}`);v.vehicle?(d(v.vehicle),N(n),h("âœ… Vehicle verified!")):h("âŒ Vehicle not found in database")}catch{h(`âš ï¸ Vehicle ${r} scanned (API unavailable)`),d({vehicleNumber:r,vehicleType:"Unknown",vehicleOwner:"Unknown",driverName:"Unknown",driverMobileNumber:"N/A"}),N(n)}}catch{h("âŒ Failed to process QR code")}finally{w(!1)}},u=async n=>{if(n.preventDefault(),!x||!j)return h("Please scan a QR code first.");w(!0),h("Submitting log entry...");try{const r={...c};let v=!1;try{const C=JSON.parse(x);C&&C.payload&&C.signature&&(v=!0)}catch{}v?r.qrData=x:r.vehicleNumber=j.vehicleNumber,await k.post("/api/security-guards/logs",r),h(`âœ… Successfully logged ${c.direction} for ${j.vehicleNumber}`),setTimeout(()=>{N(null),d(null),h("")},3e3)}catch(r){h(`âŒ ${r?.response?.data?.message||"Failed to log entry"}`)}finally{w(!1)}},S=()=>{N(null),d(null),h(""),l(0)};return e.jsxs("div",{className:"qr-scanner-container",children:[a?e.jsxs("div",{ref:p,className:`scanner-active-container ${y?"fullscreen":""}`,children:[e.jsxs("div",{className:"scanner-header-active",children:[e.jsxs("div",{className:"scanner-status",children:[e.jsx("div",{className:"status-indicator active"}),e.jsx("span",{children:"Camera Active"})]}),e.jsxs("div",{className:"scan-counter",children:["Scans: ",R]})]}),e.jsxs("div",{className:"scanner-viewport",children:[e.jsx("video",{ref:T,className:`scanner-video ${D?"scan-success":""}`,muted:!0,playsInline:!0}),e.jsxs("div",{className:"scanner-overlay",children:[e.jsxs("div",{className:"scanner-frame",children:[e.jsx("div",{className:"frame-corner top-left"}),e.jsx("div",{className:"frame-corner top-right"}),e.jsx("div",{className:"frame-corner bottom-left"}),e.jsx("div",{className:"frame-corner bottom-right"}),e.jsx("div",{className:"scanning-line"})]}),e.jsx("div",{className:"scanner-instructions-overlay",children:e.jsx("p",{children:"Position QR code within the frame"})})]}),L&&e.jsxs("div",{className:"scanner-loading-overlay",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Processing QR Code..."})]})]}),e.jsxs("div",{className:"scanner-controls",children:[e.jsxs("button",{className:"btn danger stop-btn",onClick:P,children:[e.jsx("span",{className:"btn-icon",children:"â¹ï¸"}),"Stop Scanner"]}),x&&e.jsxs("button",{className:"btn secondary reset-btn",onClick:S,children:[e.jsx("span",{className:"btn-icon",children:"ğŸ”„"}),"Reset"]})]})]}):e.jsxs("div",{className:"scanner-start-screen",children:[e.jsxs("div",{className:"scanner-header",children:[e.jsx("h2",{children:"QR Code Scanner"}),e.jsx("p",{children:"Scan vehicle QR codes for quick entry/exit logging"})]}),e.jsxs("div",{className:"scanner-instructions",children:[e.jsxs("div",{className:"instruction-item",children:[e.jsx("div",{className:"instruction-icon",children:"ğŸ“±"}),e.jsxs("div",{className:"instruction-text",children:[e.jsx("h4",{children:"Position Device"}),e.jsx("p",{children:"Hold your device steady and point camera at QR code"})]})]}),e.jsxs("div",{className:"instruction-item",children:[e.jsx("div",{className:"instruction-icon",children:"ğŸ¯"}),e.jsxs("div",{className:"instruction-text",children:[e.jsx("h4",{children:"Align QR Code"}),e.jsx("p",{children:"Center the QR code within the scanning frame"})]})]}),e.jsxs("div",{className:"instruction-item",children:[e.jsx("div",{className:"instruction-icon",children:"âœ¨"}),e.jsxs("div",{className:"instruction-text",children:[e.jsx("h4",{children:"Auto Detection"}),e.jsx("p",{children:"Scanner will automatically detect and process the code"})]})]})]}),e.jsxs("div",{className:"scanner-actions",children:[e.jsxs("button",{className:"btn scanner-start-btn",onClick:O,children:[e.jsx("span",{className:"btn-icon",children:"ğŸ“·"}),"Start Camera Scanner"]}),e.jsxs("button",{className:"btn secondary test-btn",onClick:s,children:[e.jsx("span",{className:"btn-icon",children:"ğŸ§ª"}),"Test with Sample QR"]})]})]}),x&&j&&e.jsxs("div",{className:"scan-result-card",children:[e.jsxs("div",{className:"result-header",children:[e.jsx("div",{className:"success-icon",children:"âœ…"}),e.jsx("h3",{children:"QR Code Scanned Successfully"})]}),e.jsxs("div",{className:"vehicle-info-card",children:[e.jsx("div",{className:"vehicle-number",children:j.vehicleNumber}),e.jsxs("div",{className:"vehicle-details-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Type:"}),e.jsx("span",{className:"detail-value",children:j.vehicleType})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Owner:"}),e.jsx("span",{className:"detail-value",children:j.vehicleOwner})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Driver:"}),e.jsx("span",{className:"detail-value",children:j.driverName||"N/A"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("span",{className:"detail-label",children:"Mobile:"}),e.jsx("span",{className:"detail-value",children:j.driverMobileNumber||"N/A"})]})]})]}),e.jsxs("div",{className:"log-entry-form",children:[e.jsx("h4",{children:"Complete Entry Log"}),e.jsxs("form",{onSubmit:u,className:"entry-form",children:[e.jsxs("div",{className:"form-row-scanner",children:[e.jsxs("div",{className:"form-group-scanner",children:[e.jsx("label",{children:"Select Gate"}),e.jsxs("select",{className:"input scanner-select",value:c.gateNumber,onChange:n=>f(r=>({...r,gateNumber:n.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Choose Gate"}),m.map(n=>e.jsxs("option",{value:n.gateNumber,children:[n.gateName," (",n.gateNumber,")"]},n._id))]})]}),e.jsxs("div",{className:"form-group-scanner",children:[e.jsx("label",{children:"Direction"}),e.jsxs("select",{className:"input scanner-select direction-select",value:c.direction,onChange:n=>f(r=>({...r,direction:n.target.value})),required:!0,children:[e.jsx("option",{value:"IN",children:"ğŸ”½ Entry (IN)"}),e.jsx("option",{value:"OUT",children:"ğŸ”¼ Exit (OUT)"})]})]})]}),e.jsx("button",{className:"btn submit-log-btn",type:"submit",disabled:L||!c.gateNumber,children:L?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"btn-spinner"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"btn-icon",children:"ğŸ“"}),"Log ",c.direction==="IN"?"Entry":"Exit"]})})]})]})]}),o&&e.jsx("div",{className:`scanner-message ${o.includes("âœ…")?"success":o.includes("âŒ")?"error":o.includes("âš ï¸")?"warning":"info"}`,children:e.jsx("p",{children:o})})]})}const Y=Object.freeze(Object.defineProperty({__proto__:null,default:X},Symbol.toStringTag,{value:"Module"}));export{te as G,ne as Q,J as _,k as a,ae as b,re as c,ce as d,ie as e};
